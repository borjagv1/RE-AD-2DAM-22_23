METODO ejercicio1


LLAMADA AL METODO

ejercicio1("1Marcos1","1Magaña1","1Perez","3897",  "marcos@jardineria.es","TAL-ES",2,"Director General");







private static void ejercicio1(String nombre, String ape1, String ape2, String extension, String email,

			String CodigoOficina, int CodigoJefe, String Puesto) throws SQLException {



		// construir orden INSERT

		String sql = "INSERT INTO empleados VALUES " 

		  + "( ?, ?, ? , ?, ?, ?, ? , ?, ?)";



		// El código de empleado será una unidad más,

		// al código de empleado máximo almacenado en la tabla.

		int codEmpleado = DameCodEmpleado();



		PreparedStatement sentencia = conexion.prepareStatement(sql);

		sentencia.setInt(1, codEmpleado);

		sentencia.setString(2, nombre);

		sentencia.setString(3, ape1);

		sentencia.setString(4, ape2);

		sentencia.setString(5, extension);

		sentencia.setString(6, email);

		sentencia.setString(7, CodigoOficina);

		sentencia.setInt(8, CodigoJefe);

		sentencia.setString(9, Puesto);



		// Al insertar comprobar que exista el código de oficina y el código de jefe.



		// Visualizar todos los mensajes de error que ocurran, e indicar si el registro

		// se ha insertado o no.



		try {

			sentencia.executeUpdate();

			System.out.println("Registro INSERTADO....");

		} catch (SQLException e) {

			if (e.getErrorCode() == 2291) { // error en fk



				if (e.getMessage().contains("EMPLEADOS_OFICINASFK")) {



					System.out.println("ERROR. EL codigo de oficina no existe");

				} else {

					System.out.println("ERROR. EL codigo de Jefe (cod empleado) no existe");

				}

			} else { // OTROS ERRORES

				System.out.println("HA OCURRIDO UNA EXCEPCIÓN:");



				System.out.println("Mensaje:    " + e.getMessage());

				System.out.println("SQL estado: " + e.getSQLState());

				System.out.println("Cód error:  " + e.getErrorCode());

			}

		}



	}// ejercicio1



	private static int DameCodEmpleado() throws SQLException {



		String sql = "SELECT MAX(CodigoEmpleado) + 1 FROM EMPLEADOS";



		Statement sentencia = conexion.createStatement();

		ResultSet resul = sentencia.executeQuery(sql);



		int n = 0;

		if (resul.next()) {



			n = resul.getInt(1);

		}



		return n;

	}