
---------------------------------------------------
drop type EMPLEADO_T;

CREATE TYPE EMPLEADO_T AS OBJECT (
  NOMBRE     VARCHAR2(30),
  JEFE       REF EMPLEADO_T
);
/
drop table EMPLEADO;
CREATE TABLE EMPLEADO OF EMPLEADO_T;

INSERT INTO EMPLEADO VALUES 
  (EMPLEADO_T ('GIL', NULL));

select * from EMPLEADO;

INSERT INTO EMPLEADO 
  SELECT EMPLEADO_T ('ARROYO', REF(E))
  FROM EMPLEADO E WHERE E.NOMBRE = 'GIL';

INSERT INTO EMPLEADO 
  SELECT EMPLEADO_T ('RAMOS', REF(E))
  FROM EMPLEADO E WHERE E.NOMBRE = 'GIL';

--no inserta nada, SANCHEZ NO EXISTE   
INSERT INTO EMPLEADO 
  SELECT EMPLEADO_T ('PEREZ', REF(E))
  FROM EMPLEADO E WHERE E.NOMBRE = 'SANCHEZ';

INSERT INTO EMPLEADO 
  SELECT EMPLEADO_T ('PEREZ', REF(E))
  FROM EMPLEADO E WHERE E.NOMBRE = 'GIL';
  
commit;
select * from EMPLEADO;
--
SELECT NOMBRE, DEREF(P.JEFE) FROM EMPLEADO P;
---
--INSERTAR OTRA FILA QUE EL JEFE APUNTE A PEREZ

INSERT INTO EMPLEADO 
  SELECT EMPLEADO_T ('FERNANDEZ', REF(E))
  FROM EMPLEADO E WHERE E.NOMBRE = 'PEREZ';
  --
INSERT INTO EMPLEADO 
  SELECT EMPLEADO_T ('RAMOS', REF(E))
  FROM EMPLEADO E WHERE E.NOMBRE = 'PEREZ';

COMMIT;

SELECT REF(P) FROM EMPLEADO P WHERE NOMBRE='GIL';


SELECT NOMBRE, DEREF(P.JEFE) FROM EMPLEADO P;
SELECT NOMBRE, DEREF(P.JEFE).nombre FROM EMPLEADO P;
SELECT NOMBRE, P.JEFE.nombre FROM EMPLEADO P;
SELECT REF(P) FROM EMPLEADO P WHERE NOMBRE='GIL';

 --
INSERT INTO EMPLEADO 
  SELECT EMPLEADO_T ('RAMOS', REF(E))
  FROM EMPLEADO E WHERE E.NOMBRE = 'PEREZ';


 --CAMBIAMOS EL JEFE DE RAMOS, LE ASIGNAMOS GIL
update empleado
  set jefe = ( select ref(e) from empleado e where nombre='GIL')
where nombre='RAMOS';

SELECT NOMBRE, P.JEFE.nombre FROM EMPLEADO P;

---ACTIVIDAD 8
---------------------FIN REFERENCISAS-
=============================================================================================================================
EJERCICIO 4.8

CREATE TABLE REF_T_DEP(
EMP_NO NUMBER(4),
APELLIDO VARCHAR2(15),
SALARIO NUMBER(6,2),
DEPT REF T_DEP
);
  INSERT INTO REF_T_DEP SELECT E.EMP_NO,E.APELLIDO,E.SALARIO,REF(D) 
  FROM EMPLEADOS E,DEPART D WHERE E.DEPT_NO = D.DEPT_NO;
  COMMIT;

  =====================================================================
  --PRUEBAS
  CREATE OR REPLACE TYPE EMPLEADO_T AS OBJECT(
NOMBRE  VARCHAR2(30),
JEFE    REF EMPLEADO_T
);
/

CREATE TABLE EMPLEADO OF EMPLEADO_T;
/
INSERT INTO EMPLEADO VALUES (EMPLEADO_T('GIL', NULL));
/
INSERT INTO EMPLEADO SELECT EMPLEADO_T('ARROYO', REF(E)) FROM EMPLEADO E WHERE E.NOMBRE = 'GIL';
/
INSERT INTO EMPLEADO SELECT EMPLEADO_T('RAMOS', REF(E)) FROM EMPLEADO E WHERE E.NOMBRE = 'GIL';
/
SELECT NOMBRE, DEREF(P.JEFE) FROM EMPLEADO P;
/
SELECT REF(P) FROM EMPLEADO P WHERE P.NOMBRE = 'GIL';
/
SELECT NOMBRE, DEREF(P.JEFE).NOMBRE FROM EMPLEADO P;
-- ACTUALIZAR EL JEFE DE NOMBRE 'RAMOS' QUE SE LLAME 'ARROYO'
UPDATE EMPLEADO SET DEREF(P.JEFE).NOMBRE = 'ARROYO' FROM EMPLEADO P WHERE P.NOMBRE = 'RAMOS'