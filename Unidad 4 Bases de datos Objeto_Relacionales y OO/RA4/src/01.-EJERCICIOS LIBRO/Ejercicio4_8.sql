--ejercicio 4_8

-- CREAR UN TIPO T_DEP CON LAS COLUMNAS DE LA TABLA DEPARTAMENTOS
CREATE OR REPLACE TYPE T_DEP AS OBJECT (
    DEPT_NO NUMBER(2),
    DNOMBRE VARCHAR2(15),
    LOC VARCHAR2(15)
);
/
-- CREAR TABLA DEL TIPO T_DEP CON LOS DATOS DE LA TABLA DEPARTAMENTOS
CREATE TABLE TABLA_DEP OF T_DEP;
/
--INSERTAR LOS DATOS DE LA TABLA DEPARTAMENTOS EN LA TABLA DEL TIPO T_DEP
INSERT INTO TABLA_DEP (DEP_TNO, DNOMBRE, LOC)
SELECT DEPT_NO, DNOMBRE, LOC FROM DEPARTAMENTOS;
/
-- CREAR TABLA CON LOS DATOS DE LA TABLA EMPLEADOS, EL ÚLTIMO DATO ES DEPT DE TIPO T_DEP
CREATE TABLE TABLA_EMP(
    EMP_NO NUMBER(4),
    APELLIDO VARCHAR2(15),
    SALARIO NUMBER(6,2),
    DEPT REF T_DEP
);
-- INSERTAR LOS DATOS DE LA TABLA EMPLEADOS EN LA TABLA TABLA_EMP
INSERT INTO TABLA_EMP (EMP_NO, APELLIDO, SALARIO, DEPT)
SELECT EMP_NO, APELLIDO, SALARIO, REF(D) 
FROM EMPLEADOS e, TABLA_DEP d where e.DEPT_NO = d.DEPT_NO;
/
-- BLOQUE PL/SQL PARA MOSTRAR EL APELLIDO, EL SALARIO, NUMERO DE DEPARTAMENTO, NOMBRE DEL DEPARTAMENTO Y LOCALIZACIÓN
BEGIN
  FOR emp IN (SELECT APELLIDO, SALARIO, DEREF(E.DEPT).LOC AS LOCALIDAD, DEREF(E.DEPT).DNOMBRE AS NOMBRE_DEPT, DEREF(E.DEPT).DEPT_NO AS No_DEPTO
              FROM TABLA_EMP E)
  LOOP
    DBMS_OUTPUT.PUT_LINE('Apellido: ' || emp.APELLIDO);
    DBMS_OUTPUT.PUT_LINE('Salario: ' || emp.SALARIO);
    DBMS_OUTPUT.PUT_LINE('Número de Departamento: ' || emp.No_DEPTO);
    DBMS_OUTPUT.PUT_LINE('Nombre del Departamento: ' || emp.NOMBRE_DEPT);
    DBMS_OUTPUT.PUT_LINE('Localidad: ' || emp.LOCALIDAD);
    DBMS_OUTPUT.PUT_LINE('---------------------------');
  END LOOP;
END;
/


